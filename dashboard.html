<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sound Trigger Dashboard</title>

<!-- Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-slate-900 text-white min-h-screen flex items-center justify-center">

<div class="bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-md space-y-6">

  <h1 class="text-2xl font-bold text-center">ðŸ”” Sound Control Panel</h1>

  <!-- Status Card -->
  <div class="bg-slate-700 p-4 rounded-xl space-y-3">

    <div class="flex justify-between">
      <span>PC Status</span>
      <span id="pcStatus" class="font-semibold">Checking...</span>
    </div>

    <div class="flex justify-between">
      <span>Sound File</span>
      <span id="soundStatus">Checking...</span>
    </div>

    <div class="flex justify-between">
      <span>Last Seen</span>
      <span id="lastSeen" class="text-sm text-slate-300">â€”</span>
    </div>

  </div>

  <!-- Trigger Button -->
  <button onclick="triggerSound()"
    class="w-full bg-emerald-600 hover:bg-emerald-700 active:scale-95 transition p-3 rounded-xl font-semibold">
    ðŸ”Š Play Sound
  </button>

  <!-- Refresh indicator -->
  <div class="text-center text-xs text-slate-400">
    Auto refresh every 2 seconds
  </div>

</div>

<script>
const BASE = "https://troll-lab-default-rtdb.asia-southeast1.firebasedatabase.app/soundSystem";

async function fetchData() {
  try {
    const r = await fetch(BASE + ".json");
    const data = await r.json();

    if (!data) return;

    updateStatus(data);

  } catch (e) {
    setOfflineUI();
  }
}

function updateStatus(data) {
  const now = Date.now();
  let online = false;

  if (data.lastSeen) {
    const last = new Date(data.lastSeen).getTime();
    online = (now - last) <= 5000;
    document.getElementById("lastSeen").textContent = data.lastSeen;
  }

  const pcEl = document.getElementById("pcStatus");
  pcEl.textContent = online ? "ONLINE" : "OFFLINE";
  pcEl.className = online
    ? "font-semibold text-green-400"
    : "font-semibold text-red-400";

  const soundEl = document.getElementById("soundStatus");
  if (online && data.soundLoaded === true) {
    soundEl.textContent = "Loaded";
    soundEl.className = "text-green-400";
  } else if (online) {
    soundEl.textContent = "Missing";
    soundEl.className = "text-yellow-400";
  } else {
    soundEl.textContent = "Unknown";
    soundEl.className = "text-slate-400";
  }
}

function setOfflineUI() {
  document.getElementById("pcStatus").textContent = "OFFLINE";
  document.getElementById("pcStatus").className = "font-semibold text-red-400";
}

async function triggerSound() {
  await fetch(BASE + "/trigger.json", {
    method: "PUT",
    body: "true"
  });
}

setInterval(fetchData, 2000);
fetchData();
</script>

</body>
</html>
